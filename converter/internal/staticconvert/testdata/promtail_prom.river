discovery.consul "name3_jobName" {
	services         = ["myapp"]
	follow_redirects = true
	enable_http2     = true
}

prometheus.scrape "name3_jobName" {
	targets = concat(
		discovery.consul.name3_jobName.targets,
		[{
			__address__ = "localhost:9101",
		}],
		[{
			__address__ = "localhost:9101",
		}],
	)
	forward_to = [prometheus.remote_write.name3.receiver]
	job_name   = "jobName"
}

prometheus.remote_write "name3" {
	endpoint {
		name = "name3-ca06cf"
		url  = "http://localhost:9009/api/prom/push"

		queue_config { }

		metadata_config { }
	}
}

discovery.consul "name_jobName" {
	datacenter    = "bigdata"
	tag_separator = ";"
	scheme        = "sketchy"
	username      = "toby"
	password      = "this_password_is_safe_innit?"
	allow_stale   = false
	services      = ["myapp"]
	tags          = ["better", "faster", "stronger"]
	node_meta     = {
		what  = "this",
		where = "here",
	}
	refresh_interval = "10m0s"

	basic_auth {
		username = "toby"
		password = "this_password_is_safe_innit?"
	}
	follow_redirects = true
	enable_http2     = true
}

discovery.relabel "name_jobName" {
	targets = discovery.consul.name_jobName.targets

	rule {
		source_labels = ["host"]
		target_label  = "hostname"
	}
}

local.file_match "name_jobName" {
	path_targets = discovery.relabel.name_jobName.output
}

loki.source.file "name_jobName" {
	targets    = local.file_match.name_jobName.targets
	forward_to = [loki.write.name.receiver]
}

loki.write "name" {
	endpoint {
		url              = "http://localhost/loki/api/v1/push"
		follow_redirects = false
		enable_http2     = false
	}
	external_labels = {}
}

discovery.consul "name2_jobName" {
	datacenter    = "bigdata"
	tag_separator = ";"
	scheme        = "sketchy"
	username      = "toby"
	password      = "this_password_is_safe_innit?"
	allow_stale   = false
	services      = ["myapp"]
	tags          = ["better", "faster", "stronger"]
	node_meta     = {
		what  = "this",
		where = "here",
	}
	refresh_interval = "10m0s"

	basic_auth {
		username = "toby"
		password = "this_password_is_safe_innit?"
	}
	follow_redirects = true
	enable_http2     = true
}

discovery.relabel "name2_jobName" {
	targets = discovery.consul.name2_jobName.targets

	rule {
		source_labels = ["host"]
		target_label  = "hostname"
	}
}

local.file_match "name2_jobName" {
	path_targets = discovery.relabel.name2_jobName.output
}

loki.source.file "name2_jobName" {
	targets    = local.file_match.name2_jobName.targets
	forward_to = [loki.write.name2.receiver]
}

loki.write "name2" {
	endpoint {
		url              = "http://localhost/loki/api/v1/push"
		follow_redirects = false
		enable_http2     = false
	}
	external_labels = {}
}
